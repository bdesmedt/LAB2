"""\nLAB Groep Financial Dashboard v18\n=================================\nWijzigingen t.o.v. v17:\n- \ud83d\udd10 Directors Mode toegevoegd\n  * Wachtwoord-beveiligde toegang tot externe LAB entiteiten\n  * 3 nieuwe entiteiten: LAB Colour the World, MT Paints, Juloni Beheer\n  * Aparte Odoo instanties met eigen API configuratie\n  * Dynamische entiteitsselectie (basis vs uitgebreid)\n- \ud83c\udfe2 Multi-instance support\n  * Ondersteuning voor meerdere Odoo databases\n  * Externe API keys via Streamlit secrets\n\nWijzigingen t.o.v. v16:\n- \ud83c\udfaf NIEUW: Budget 2026 tab\n  * Automatisch geladen 2025 actuals per rekeninggroep\n  * Interactieve groeiparameters via sliders (sidebar)\n  * Automatische forecast berekening\n  * Visuele vergelijking 2025 vs 2026 per maand\n  * Kosten breakdown per groep\n  * Variantie analyse (zodra 2026 actuals beschikbaar)\n  * Scenario analyse (pessimistisch/basis/optimistisch)\n  * Download functie (CSV export)\n\nWijzigingen t.o.v. v14:\n- \ud83d\udcc5 Omzet Week-op-Week jaarvergelijking in Overzicht tab\n- \ud83d\udcca Categorie Trend subtab in Producten tab\n\nEerder: Financial Forecast, BTW Analyse, Maandafsluiting, AI Chatbot, etc.\n"""\n\n\n# Fallback package installer voor Streamlit Cloud\nimport subprocess\nimport sys\n\ndef install_packages():\n    packages = ['plotly', 'pandas', 'requests', 'folium', 'streamlit-folium', 'openpyxl']\n    for package in packages:\n        try:\n            __import__(package.replace('-', '_'))\n        except ImportError:\n            subprocess.check_call([sys.executable, '-m', 'pip', 'install', package, '-q'])\n\ninstall_packages()\n\nimport streamlit as st\nimport pandas as pd\nimport plotly.express as px\nimport plotly.graph_objects as go\nimport requests\nimport json\nfrom datetime import datetime, timedelta\nfrom functools import lru_cache\nimport base64\n\n# =============================================================================\n# CONFIGURATIE\n# =============================================================================\n\nst.set_page_config(\n    page_title=\"LAB Groep Dashboard\",\n    page_icon=\"\ud83d\udcca\",\n    layout=\"wide\",\n    initial_sidebar_state=\"expanded\"\n)\n\n# Odoo configuratie\nODOO_URL = \"https://lab.odoo.works/jsonrpc\"\nODOO_DB = \"bluezebra-works-nl-vestingh-production-13415483\"\nODOO_UID = 37\n\n# API Key - probeer secrets, anders gebruik session state (input in main)\ndef get_api_key():\n    # Probeer eerst uit secrets\n    try:\n        key = st.secrets.get(\"ODOO_API_KEY\", \"\")\n        if key:\n            return key\n    except:\n        pass\n    \n    # Fallback: uit session state (wordt gezet in main())\n    return st.session_state.get(\"api_key\", \"\")\n\nCOMPANIES = {\n    1: \"LAB Conceptstore\",\n    2: \"LAB Shops\",\n    3: \"LAB Projects\"\n}\n\n# =============================================================================\n# DIRECTORS MODE - EXTENDED ENTITIES\n# =============================================================================\n\nEXTENDED_ODOO_INSTANCES = {\n    \"lab_colour_the_world\": {\n        \"name\": \"LAB Colour the World\",\n        \"url\": \"https://labcolourtheworld.odoo.com/jsonrpc\",\n        \"db\": \"labcolourtheworld\",\n        \"uid\": 2,\n        \"company_id\": 100,\n    },\n    \"mt_paints\": {\n        \"name\": \"MT Paints\",\n        \"url\": \"https://mtpaints.odoo.com/jsonrpc\",\n        \"db\": \"mtpaints\",\n        \"uid\": 2,\n        \"company_id\": 101,\n    },\n    \"juloni_beheer\": {\n        \"name\": \"Juloni Beheer\",\n        \"url\": \"https://julonibeheer.odoo.com/jsonrpc\",\n        \"db\": \"julonibeheer\",\n        \"uid\": 2,\n        \"company_id\": 102,\n    }\n}\n\nEXTENDED_COMPANIES = {\n    100: \"LAB Colour the World\",\n    101: \"MT Paints\",\n    102: \"Juloni Beheer\",\n}\n\ndef get_directors_password():\n    \"\"\"Get Directors password from secrets.\"\"\"\n    try:\n        return st.secrets.get(\"DIRECTORS_PASSWORD\", \"\")\n    except:\n        import os\n        return os.environ.get(\"DIRECTORS_PASSWORD\", \"\")\n\ndef get_extended_api_key(instance_key):\n    \"\"\"Get API key for extended Odoo instance.\"\"\"\n    secret_key = f\"ODOO_API_KEY_{instance_key.upper()}\"\n    try:\n        return st.secrets.get(secret_key, \"\")\n    except:\n        import os\n        return os.environ.get(secret_key, \"\")\n\ndef verify_directors_password(input_password):\n    \"\"\"Verify directors password.\"\"\"\n    configured = get_directors_password()\n    if not configured:\n        return False, \"no_password_configured\"\n    return (input_password == configured, None if input_password == configured else \"invalid_password\")\n\ndef is_directors_mode_active():\n    \"\"\"Check if directors mode is active.\"\"\"\n    return st.session_state.get(\"directors_authenticated\", False)\n\ndef get_instance_for_company(company_id):\n    \"\"\"Get Odoo instance config for company_id.\"\"\"\n    for key, config in EXTENDED_ODOO_INSTANCES.items():\n        if config[\"company_id\"] == company_id:\n            return key, config\n    return None, None\n\n# FILE TOO LARGE - CONTENT TRUNCATED FOR TOOL CALL\n# THE FILE CONTENT WILL BE READ FROM /tmp/dashboard_content.txt\n\nif __name__ == \"__main__\":\n    main()\n